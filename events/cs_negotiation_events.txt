
namespace = civilnegotiations 


planet_event = {
	id = civilnegotiations.1
	title = civilnegotiations.1.name
	desc = civilnegotiations.1.desc
	picture = GFX_evt_tradestation_interior
	show_sound = event_conversation
	location = this
	#hide_window = yes
	is_triggered_only = yes

	pre_triggers = {
		is_occupied_flag = no
		has_ground_combat = no
	}
	
	trigger = {
		NOT = { has_planet_flag = cs_demands_declared_flag }
	}

	immediate = {
		planet_event = {
			id = civilnegotiations.2
			days = 15
		}
		#set_planet_flag = cs_negotiations_active_flag
	}


	option = {
		name = OK
	}

}


# DEMANDS
planet_event = {
	id = civilnegotiations.2
	title = civilnegotiations.2.name

	desc = {	
		text = civilnegotiations.2.desc_leader
		trigger = {
			has_planet_flag = cs_demand_leader_dismissal_flag
		}
	}

	desc = {	
		text = civilnegotiations.2.desc_taxes
		trigger = {
			has_planet_flag = cs_demand_taxes_flag
		}
	}

	desc = {	
		text = civilnegotiations.2.desc_amenities
		trigger = {
			has_planet_flag = cs_demand_amenities_flag
		}
	}

	desc = {	
		text = civilnegotiations.2.desc_worker_places
		trigger = {
			has_planet_flag = cs_demand_work_flag
		}
	}

	desc = {	
		text = civilnegotiations.2.desc_rights
		trigger = {
			has_planet_flag = cs_demand_rights_flag
			event_target:cs_target_species_rights = {
				is_exact_same_species = event_target:cs_target_species_rights_from
			}
		}
	}

	desc = {	
		text = civilnegotiations.2.desc_rights_different
		trigger = {
			has_planet_flag = cs_demand_rights_flag
			event_target:cs_target_species_rights = {
				NOT = { 
					is_exact_same_species = event_target:cs_target_species_rights_from 
				}
			}
		}
	}

	picture = GFX_evt_cs_protest
	show_sound = event_public_unrest
	#hide_window = yes
	location = this
	is_triggered_only = yes

	pre_triggers = {
		is_occupied_flag = no
		has_ground_combat = no
	}
	
	immediate = {
		random_list = {
			20 = {
				modifier = {
					add = 15
					has_corrupted_trait = yes
				}
				modifier = {
					factor = 0
					OR = {
						NOT = { exists = sector }
						sector = {
							NOT = { exists = leader }
						}
						has_planet_flag = cs_leader_dismissed_cooldown
					}
				}

				log = "CS - NEGOTIATIONS: LEADER DEMAND ([this.GetName])"
				set_planet_flag = cs_demand_leader_dismissal_flag
				sector = {
					save_event_target_as = cs_target_sector_ai
					leader = {
						save_event_target_as = dismissed_leader
					}
				}

				if = {
					limit = { owner = { is_ai = yes } }

					owner = {
						country_event = {
							id = civilnegotiations.50
							days = 30
						}
					}
					
				}

				set_timed_planet_flag = {
					flag = cs_demands_declared_flag
					days = 360
				}

				planet_event = {
					id = civilnegotiations.10
					days = 15
				}

			}
			25 = {
				set_planet_flag = cs_demand_taxes_flag
				log = "CS - NEGOTIATIONS: TAXES DEMAND ([this.GetName])"
			}
			25 = {
				modifier = {
					add = 10
					has_planet_flag = cs_reason_amenities
				}

				log = "CS - NEGOTIATIONS: AMENITIES DEMAND ([this.GetName])"
				set_planet_flag = cs_demand_amenities_flag

				random_list = {
					1 = {
						set_variable = {
							which = demanded_amenities
							value = 15
						}
					}
					2 = {
						modifier = {
							factor = 0
							free_amenities >= 10
						}
						set_variable = {
							which = demanded_amenities
							value = 10
						}
					}
					3 = {
						modifier = {
							factor = 0
							free_amenities >= 5
						}
						set_variable = {
							which = demanded_amenities
							value = 5
						}
					}
				}

				if = {
					limit = { owner = { is_ai = yes } }
					planet_event = {
						id = civilnegotiations.52
						days = 2
					}
				}

				set_timed_planet_flag = {
					flag = cs_demands_declared_flag
					days = 540
				}
				
				planet_event = {
					id = civilnegotiations.11
					days = 15
				}


			}
			5 = {
				modifier = {
					factor = 0
				}
				modifier = {
					add = 4
					has_planet_flag = cs_reason_workerplaces
				}
				modifier = {
					add = 25
					has_unemployed_amount_demand = { NUMBER = 5 } 
				}
				modifier = {
					add = 20
					has_unemployed_amount_demand = { NUMBER = 10 }
				}
				modifier = {
					add = 10
					has_unemployed_amount_demand = { NUMBER = 15 }
				}

				log = "CS - NEGOTIATIONS: EMPLOYMENT DEMAND ([this.GetName])"
				
				random_list = {
					3 = {
						modifier = {
							factor = 0
							has_unemployed_amount_demand = { NUMBER = 5 }
						}
						set_variable = {
							which = demanded_worker_places
							value = 5
						}
					}
					2 = {
						set_variable = {
							which = demanded_worker_places
							value = 3
						}
					}
					1 = {
						set_variable = {
							which = demanded_worker_places
							value = 2
						}
					}
				}

				if = {
					limit = { owner = { is_ai = yes } }
					planet_event = {
						id = civilnegotiations.53
						days = 2
					}
				}

				set_planet_flag = cs_demand_work_flag

				set_timed_planet_flag = {
					flag = cs_demands_declared_flag
					days = 540
				}

				planet_event = {
					id = civilnegotiations.12
					days = 15
				}

			}
			1 = {
				modifier = {
					factor = 0
				}
				modifier = {
					add = 15
					any_owned_species = {
						root = {
							count_owned_pop = {
								limit = {
									can_have_better_rights = yes
									is_exact_same_species = prev
								}
								count >= 5
							}
						}
					}
				}

				remove_planet_flag = cs_rights_demand_fulfilled
				#remove_planet_flag = cs_demand_rights_flag

				log = "CS - NEGOTIATIONS: RIGHTS DEMAND ([this.GetName])"

				random_owned_species = {
					limit = {
						root = {
							count_owned_pop = {
								limit = {
									is_exact_same_species = prevprev
								}
								count >= 5
							}
						}
					}
					weights = {
						base = 1
						modifier = {
							add = 7
							is_majority_species = root
						}
						modifier = {
							add = 5
							cs_count_species_planet = { NUMBER = 10 }
						}
						modifier = {
							add = 5
							cs_count_species_planet = { NUMBER = 15 }
						}
						modifier = {
							add = -5
							has_trait = trait_conformists
						}
						modifier = {
							add = 2
							has_trait = trait_quarrelsome
						}
						modifier = {
							add = 3
							has_trait = trait_unruly
						}
						modifier = {
							add = 3
							has_trait = trait_deviants
						}
						modifier = {
							add = -3
							has_trait = trait_decadent
						}
						#modifier = {
							#add = 7000
							#root = {                              
								#is_majority_species = prev
							#}
						#}
					}
					save_event_target_as = cs_target_species_rights_from
					log = "picked from species [cs_target_species_rights_from.GetNamePlural]"
				}


				random_owned_species = {
					limit = {
						root = {
							any_owned_pop = {
								can_have_better_rights = yes 
								is_exact_same_species = prevprev
							}
							count_owned_pop = {
								limit = {
									is_exact_same_species = prev
								}
								count >= 5
							}
						}
					}
					weights = {
						base = 1
						modifier = {
							add = 5
							cs_count_species_planet = { NUMBER = 10 } 
						}
						modifier = {
							add = 5
							cs_count_species_planet = { NUMBER = 15 } 
						}
						modifier = {
							add = -5
							has_trait = trait_conformists
							is_exact_same_species = event_target:cs_target_species_rights_from
						}
						modifier = {
							add = 2
							has_trait = trait_quarrelsome
							is_exact_same_species = event_target:cs_target_species_rights_from
						}
						modifier = {
							add = 3
							has_trait = trait_unruly
							is_exact_same_species = event_target:cs_target_species_rights_from
						}
						modifier = {
							add = 3
							has_trait = trait_deviants
							is_exact_same_species = event_target:cs_target_species_rights_from
						}
						modifier = {
							add = -3
							has_trait = trait_decadent
							is_exact_same_species = event_target:cs_target_species_rights_from
						}
						#modifier = {
							#add = 7000
							#is_exact_same_species = event_target:cs_target_species_rights_from
							#root = {                              
								#NOT = { is_majority_species = prev }
							#}
						#}
					}

					

					save_event_target_as = cs_target_species_rights
					log = "picked [cs_target_species_rights.GetNamePlural]"

					root = {
						owner = {
							save_event_target_as = cs_target_country
						}
					}
					
					setup_rights = yes
						ROOT = {
							set_timed_planet_flag = {
								flag = cs_demand_rights_flag
								days = 120
							} 
							planet_event = {
								id = civilnegotiations.8
								days = 95
							}
							log = "[this.GetName]"
						}

				}

				if = {
					limit = { owner = { is_ai = yes } }
					owner = {
						country_event = {
							id = civilnegotiations.54
							days = 15
						}
					}
				}
				
			}
		}
		set_planet_flag = cs_demands_declared_flag
	}


	after = {
		hidden_effect = {
			remove_planet_flag  = cs_demand_amenities_flag
			remove_planet_flag  = cs_demand_taxes_flag
			remove_planet_flag  = cs_demand_leader_dismissal_flag
			remove_planet_flag  = cs_demand_work_flag
			#remove_planet_flag = cs_demand_rights_flag
		}
	}


	option = {
		name = OK
		trigger = {
			NOT = {
				has_planet_flag = cs_demand_taxes_flag
			}
		}
		ai_chance = {
			factor = 1
		}
	}
	option = {
		name = civilnegotiations.2.opt_taxes
		trigger = {
			has_planet_flag = cs_demand_taxes_flag
		}
		custom_tooltip = civilnegotiations.2.opt_taxes_tooltip
		hidden_effect = {
			civil_demand_fulfilled = { DURATION = 24 }
			#remove_planet_flag = cs_demands_declared_flag
			add_modifier = {
				modifier = civil_taxes_demand
				months = 24
			}
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 4
				owner = {
					has_monthly_income = {
						resource = energy
						value >= 50
					}
				}
			}
		}
	}
	option = {
		name = civilnegotiations.2.opt_taxes_refused
		trigger = {
			has_planet_flag = cs_demand_taxes_flag
		}
		custom_tooltip = civilnegotiations.2.opt_taxes_refused_tooltip
		hidden_effect = {
			#set_planet_flag = cs_demand_taxes_flag
			civil_demand_refused = { DURATION = 24 }
			remove_demands_flags = yes
		}
		ai_chance = {
			factor = 1
			modifier = {
				factor = 3
				owner = {
					has_monthly_income = {
						resource = energy
						value < 50
					}
				}
			}
		}
	}

}

planet_event = {
	id = civilnegotiations.69
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		every_owned_species = {
			if = {
				limit = {
					root = {
						is_majority_species = prev
					}
				}
				log = "TEST - [this.GetName] majority"
			}
			else_if = {
				limit = {
					NOT = { 
						root = {
							is_majority_species = prev
						} 
					}
				}
				log = "TEST - [this.GetName] minority"
			}
		}
	}
}


planet_event = {
	id = civilnegotiations.10
	hide_window = yes
	is_triggered_only = yes


	immediate = {
		if = {
			limit = {
				has_same_sector_leader = no
				has_planet_flag = cs_demands_declared_flag
			}
			planet_event = {
				id = civilnegotiations.3
			}
		}
		else_if = {
			limit = {
				has_same_sector_leader = yes
				NOT = { has_planet_flag = cs_demands_declared_flag } 
			}
			planet_event = {
				id = civilnegotiations.3
			}
		}
		else = {
			planet_event = {
				id = civilnegotiations.10
				days = 15
			}
		}
	}

}


# DEMANDS - LEADER - DISMISSED
planet_event = {
	id = civilnegotiations.3
	title = civilnegotiations.3.name
	desc = { 
		text = civilnegotiations.3.descA
		trigger = {
			has_same_sector_leader = no
		}
	}
	desc = {
		text = civilnegotiations.3.descB
		trigger = {
			has_same_sector_leader = yes
		}
	}
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = this
	is_triggered_only = yes


	immediate = {
		if = {
			limit = {
				has_same_sector_leader = no
			}
			set_timed_planet_flag = {
				flag = cs_employment_check_flag
				months = 18
			}
			planet_event = {
				id = civilnegotiations.4
			}
			civil_demand_fulfilled = {
				DURATION = 24
			}
			set_timed_planet_flag = {
				flag = cs_leader_dismissed_cooldown
				months = 24
			}
		}
		else = {
			civil_demand_refused = { DURATION = 24 }
			#remove_planet_flag = cs_demands_declared_flag
		}
	}

	option = {
		name = OK
		ai_chance = {
			factor = 1
		}
	}

}


# DEMANDS - LEADER - EMPLOYMENT CHECK
planet_event = {
	id = civilnegotiations.4
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		has_planet_flag = cs_employment_check_flag
	}


	immediate = {
		if = {
			limit = {
				has_same_sector_leader = yes
			}
			planet_event = {
				id = civilnegotiations.5
			}
			
		}
		else = {
			planet_event = {
				id = civilnegotiations.4
				days = 15
			}
		}
	}

}


# DEMANDS - LEADER - SAME EMPLOYMENT - BROKEN PROMISE
planet_event = {
	id = civilnegotiations.5
	title = civilnegotiations.5.name
	desc = civilnegotiations.5.desc
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = this
	is_triggered_only = yes

	immediate = {
		civil_demand_refused = { DURATION = 24 }
	}

	option = {
		name = OK
		ai_chance = {
			factor = 1
		}
	}
}


planet_event = {
	id = civilnegotiations.11
	hide_window = yes
	is_triggered_only = yes

	abort_trigger = {
		NOT = {
			has_planet_flag = cs_demands_declared_flag
		}
	}


	abort_effect = {
		planet_event = {
			id = civilnegotiations.6
		}
	}


	immediate = {
		if = {
			limit = { 
				check_variable = {
					which = demanded_amenities
					value = 15
				}
				free_amenities >= 15
			}
			planet_event = {
				id = civilnegotiations.6
			}
		}
		else_if = {
			limit = { 
				check_variable = {
					which = demanded_amenities
					value = 10
				}
				free_amenities >= 10
			}
			planet_event = {
				id = civilnegotiations.6
			}
		}
		else_if = {
			limit = { 
				check_variable = {
					which = demanded_amenities
					value = 5
				}
				free_amenities >= 5
			}
			planet_event = {
				id = civilnegotiations.6
			}
		}
		else = {
			planet_event = {
				id = civilnegotiations.11
				days = 15
			}
		}

	}

}


# DEMANDS - AMENITIES - RESULT
planet_event = {
	id = civilnegotiations.6
	title = civilnegotiations.6.name
	desc = {
		text = civilnegotiations.6.descA
		trigger = {
			has_planet_flag = cs_demand_fulfilled
		}
	}
	desc = {
		text = civilnegotiations.6.descB
		trigger = {
			has_planet_flag = cs_demand_refused
		}
	}
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = this
	is_triggered_only = yes


	after = {
		hidden_effect = {
			remove_demands_flags = yes
		}
	}

	immediate = {

		if = {
			limit = {
				free_amenities >= 15
				check_variable = {
					which = demanded_amenities
					value = 15
				}
			}
			civil_demand_fulfilled = { DURATION = 24 }
		}
		else_if = {
			limit = {
				free_amenities >= 10
				check_variable = {
					which = demanded_amenities
					value = 10
				}
			}
			civil_demand_fulfilled = { DURATION = 24 }
		}
		else_if = {
			limit = {
				free_amenities >= 5
				check_variable = {
					which = demanded_amenities
					value = 5
				}
			}
			civil_demand_fulfilled = { DURATION = 24 }
		}
		else = {
			civil_demand_refused = { DURATION = 24 }
		}

		clear_variable = demanded_amenities

	}

	option = {
		name = OK
		ai_chance = {
			factor = 1
		}
	}
}



planet_event = {
	id = civilnegotiations.12
	hide_window = yes
	is_triggered_only = yes

	abort_trigger = {
		NOT = {
			has_planet_flag = cs_demands_declared_flag
		}
	}


	abort_effect = {
		planet_event = {
			id = civilnegotiations.7
		}
	}


	immediate = {
		if = {
			limit = { 
				check_variable = {
					which = demanded_worker_places
					value = 5
				}
				has_unemployed_amount_demand = { NUMBER = 6 }
			}
			planet_event = {
				id = civilnegotiations.7
			}
		}
		else_if = {
			limit = { 
				check_variable = {
					which = demanded_worker_places
					value = 3
				}
				has_unemployed_amount_demand = { NUMBER = 4 }
			}
			planet_event = {
				id = civilnegotiations.7
			}
		}
		else_if = {
			limit = { 
				check_variable = {
					which = demanded_worker_places
					value = 2
				}
				has_unemployed_amount_demand = { NUMBER = 3 }
			}
			planet_event = {
				id = civilnegotiations.7
			}
		}
		else = {
			planet_event = {
				id = civilnegotiations.12
				days = 15
			}
		}

	}

}


# DEMANDS - WORK - RESULT
planet_event = {
	id = civilnegotiations.7
	title = civilnegotiations.7.name
	desc = {
		text = civilnegotiations.7.descA
		trigger = {
			has_planet_flag = cs_demand_fulfilled
		}
	}
	desc = {
		text = civilnegotiations.7.descB
		trigger = {
			has_planet_flag = cs_demand_refused
		}
	}
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = this
	is_triggered_only = yes


	after = {
		hidden_effect = {
			remove_demands_flags = yes
		}
	}

	immediate = {
		if = {
			limit = {
				has_unemployed_amount_demand = { NUMBER = 6 }
				check_variable = {
					which = demanded_worker_places
					value = 5
				}
			}
			civil_demand_refused = { DURATION = 24 }
		}
		else_if = {
			limit = {
				has_unemployed_amount_demand = { NUMBER = 4 }
				check_variable = {
					which = demanded_worker_places
					value = 3
				}
			}
			civil_demand_refused = { DURATION = 24 }
		}
		else_if = {
			limit = {
				has_unemployed_amount_demand = { NUMBER = 3 } 
				check_variable = {
					which = demanded_worker_places
					value = 2
				}
			}
			civil_demand_refused = { DURATION = 24 }
		}
		else = {
			civil_demand_fulfilled = {
				DURATION = 24
			}
		}

		clear_variable = demanded_worker_places
		
	}

	option = {
		name = OK
		ai_chance = {
			factor = 1
		}
	}
}



# DEMANDS - RIGHTS - GATE
planet_event = {
	id = civilnegotiations.8
	hide_window = yes
	is_triggered_only = yes
	location = this


	abort_trigger = {
		#NOT = { has_planet_flag = cs_demand_rights_flag }
		has_planet_flag = cs_demand_fulfilled
	}

	immediate = {

		if = {
			limit = {
				has_planet_flag = cs_demand_rights_flag
			}

			if = {
				limit = {
					owner = {
						any_owned_species = {
							is_exact_same_species = event_target:cs_target_species_rights
							cs_got_better_rights = yes
						}
					}
				}

				planet_event = {
					id = civilnegotiations.9
				}

				set_planet_flag = cs_rights_demand_fulfilled
				civil_demand_fulfilled = { DURATION = 24 }
				#remove_planet_flag = cs_demand_rights_flag
			}
			else = {
				planet_event = {
					id = civilnegotiations.8
					days = 15
				}
			}
		}
		else_if = {
			limit = {
				NOT = { has_planet_flag = cs_rights_demand_fulfilled }
				NOT = { has_planet_flag = cs_demand_rights_flag }
			}
			civil_demand_refused = {
				DURATION = 24
			}
			planet_event = {
				id = civilnegotiations.9
			}
		}
		
	}

}

# DEMANDS - RIGHTS - SHOW REACTION
planet_event = {
	id = civilnegotiations.9
	title = civilnegotiations.9.name
	desc = {
		text = civilnegotiations.9.desc
		trigger = {
			has_planet_flag = cs_demand_fulfilled
		}
	}
	desc = {
		text = civilnegotiations.9.descB
		trigger = {
			has_planet_flag = cs_demand_refused
		}
	}
	
	picture = GFX_evt_announcement
	show_sound = event_announcement
	location = this
	is_triggered_only = yes

	immediate = {

		remove_demands_flags = yes
		#remove_planet_flag = cs_rights_demand_fulfilled

		clear_variable = living_standart_lvl
		clear_variable = citizenship_lvl
		
	}

	option = {
		name = OK
		ai_chance = {
			factor = 1
		}
	}
}


country_event = {
	id = civilnegotiations.50
	hide_window = yes
	is_triggered_only = yes


	immediate = {

		log = "civil society: AI - leader dismiss problem solution"

		random_list = {
			10 = {
				modifier = {
					add = 2
					event_target:dismissed_leader = {
						has_trait = leader_trait_corrupt
					}
				}

				log = "civil society: AI - leader dismiss triggered"
				#unassign_leader = event_target:dismissed_leader

				event_target:dismissed_leader = {
					unassign_leader = event_target:cs_target_sector_ai
				}
				
				random_owned_leader = {
					limit = {
						NOT = {
							is_same_value = event_target:dismissed_leader
						}
						leader_class = governor
					}
					event_target:cs_target_sector_ai = {
						assign_leader = prevprev
					}
				}

				log = "civil society: AI - leader dismiss end"

			}
			1 = {
				modifier = {
					add = 1
					event_target:dismissed_leader = {
						has_level >= 5
					}
				}

				log = "civil society: AI - no dismiss"

			}
		}
	}

}


planet_event = {
	id = civilnegotiations.51
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		owner = { is_ai = yes }
	}


	immediate = {

		log = "civil society: AI - amenities demand problem on [this.GetName] solution triggered"


		if = {
			limit = { 
				NOT = { has_modifier = planet_luxuries_boost }
				AND = {
					owner = {
						resource_stockpile_compare = {
							resource = consumer_goods
							value > 700 
						}
					}
				}
			}
			add_modifier = {
				modifier = planet_luxuries_boost
				months = 120
			}
			owner = {
				add_resource = {
					consumer_goods = -500
				}
			}
		}
		else_if = {
			limit = {
				free_building_slots > 0
					OR = {
						AND = {
							has_modifier = planet_luxuries_boost
							check_variable = {
								which = demanded_amenities
								value = 15
							}
							free_amenities < 15
						}
						AND = {
							has_modifier = planet_luxuries_boost
							check_variable = {
								which = demanded_amenities
								value = 10
							}
							free_amenities < 10
						}
						AND = {
							has_modifier = planet_luxuries_boost
							check_variable = {
								which = demanded_amenities
								value = 5
							}
							free_amenities < 5
						}
					}
				NOT = {
					has_planet_flag = cs_ai_building_flag
				}
			}

				if = {
					limit = {
						NOT = { 
							has_building = building_clinic
						}  
						owner = { has_technology = tech_frontier_health }
					}
					add_building = building_clinic
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
					#building_hospital #tech_frontier_health
				}
				else_if = {
					limit = {
						has_building = building_clinic
						owner = { has_technology = tech_frontier_hospital }
					}
					add_building = building_hospital
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if = {
					limit = {
						num_buildings = {
							type = building_commercial_zone
							value <= 2
						}
						num_buildings = {
							type = building_commercial_megaplex
							value <= 2
						}
					}
					add_building = building_commercial_zone
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if = {
					limit = {
						num_buildings = {
							type = building_holo_theatres
							value <= 2
						}
						num_buildings = {
							type = building_hyper_entertainment_forum
							value <= 2
						}
					}
					add_building = building_holo_theatres
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if = {
					limit = {
						has_building = building_holo_theatres
						num_buildings = {
							type = building_hyper_entertainment_forum
							value <= 2
						}
						owner = { has_technology = tech_hyper_entertainment_forum }
					}
					add_building = building_hyper_entertainment_forum
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}

			check_planet_employment = yes

		}
		else_if = {
			limit = { 
				OR = {
					AND = {
						has_modifier = planet_luxuries_boost
						check_variable = {
							which = demanded_amenities
							value = 15
						}
						free_amenities < 15
					}
					AND = {
						has_modifier = planet_luxuries_boost
						check_variable = {
							which = demanded_amenities
							value = 10
						}
						free_amenities < 10
					}
					AND = {
						has_modifier = planet_luxuries_boost
						check_variable = {
							which = demanded_amenities
							value = 5
						}
						free_amenities < 5
					}
				}
				NOT = {
					has_planet_flag = cs_ai_building_flag
				}
			}
				
				if	= {
					limit = {
						num_free_districts = {
							type = district_city
							value > 0
						}
					}
					add_district = district_city
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_arcology_housing
							value > 0
						}
					}
					add_district = district_arcology_housing
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_arcology_leisure
							value > 0
						}
					}
					add_district = district_arcology_leisure
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_hab_commercial
							value > 0
						}
					}
					add_district = district_hab_commercial
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_hab_cultural
							value > 0
						}
					}
					add_district = district_hab_cultural
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_rw_city
							value > 0
						}
					}
					add_district = district_rw_city
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}
				else_if	= {
					limit = {
						num_free_districts = {
							type = district_rw_city
							value > 0
						}
					}
					add_district = district_rw_city
					set_timed_planet_flag = {
						flag = cs_ai_building_flag
						days = 150
					}
				}

			check_planet_employment = yes

		}

		planet_event = {
			id = civilnegotiations.52
			days = 15
		}
	}
	

}

planet_event = {
	id = civilnegotiations.52
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = { is_ai = yes }
		is_variable_set = demanded_amenities
		check_variable = {
			which = demanded_amenities
			value > 0
		}
	}


	immediate = {
		
		if = {
			limit = { 
				OR = {
					AND = {
						free_amenities < 5
						check_variable = {
							which = demanded_amenities
							value = 5
						}
					}
					AND = {
						free_amenities < 10
						check_variable = {
							which = demanded_amenities
							value = 10
						}
					}
					AND = {
						free_amenities < 15
						check_variable = {
							which = demanded_amenities
							value = 15
						}
					}
				}
			}

			planet_event = {
				id = civilnegotiations.51
			}

		}

	}
}


planet_event = {
	id = civilnegotiations.53
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		owner = {
			is_ai = yes
		}
		is_variable_set = demanded_worker_places
		check_variable = {
			which = demanded_worker_places
			value > 0
		}
	}



	immediate = {

		log = "civil society: AI - worker places demand problem on [this.GetName] solution triggered"

		random_list = {
			5 = {
				modifier = {
					add = 5
					count_owned_pop = {
						limit = {
							is_unemployed = yes
							has_job_category = worker
						}
						count >= 4
					}
				}
				modifier = {
					factor = 0
					OR = {
						free_building_slots = 0
						has_planet_flag = cs_ai_building_flag
					}
				}
				
					random_list = {
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_mineral_purification_1 } }
							}
							add_building = building_mineral_purification_plant
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_mineral_purification_2 } }
							}
							add_building = building_mineral_purification_hub
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_power_hub_1 } }
							}
							add_building = building_energy_grid
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_power_hub_2 } }
							}
							add_building = building_energy_nexus
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_power_hub_2 } }
							}
							add_building = building_energy_nexus
						}
					}

			}
			5 = {
				modifier = {
					add = 5
					count_owned_pop = {
						limit = {
							is_unemployed = yes
							has_job_category = specialist
						}
						count >= 4
					}
				}
				modifier = {
					factor = 0
					OR = {
						free_building_slots = 0
						has_planet_flag = cs_ai_building_flag
					}
				}

					random_list = {
						1 = {
							modifier = {
								add = 2
								owner = {
									has_monthly_income = {
										resource = alloys
										value < 50
									}
								}
							}

								random_list = {
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_basic_industry } }
										}
										add_building = building_foundry_1
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_alloys_1 } }
										}
										add_building = building_foundry_2
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_alloys_2 } }
										}
										add_building = building_foundry_3
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
								}

						}
						1 = {
							modifier = {
								add = 2
								owner = {
									has_monthly_income = {
										resource = consumer_goods
										value < 50
									}
								}
							}

								random_list = {
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_basic_industry } }
										}
										add_building = building_factory_1
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_consumer_good_refinement_1 } }
										}
										add_building = building_factory_2
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
									1 = {
										modifier = {
											factor = 0
											NOT = { owner = { has_technology = tech_consumer_good_refinement_2 } }
										}
										add_building = building_factory_3
										set_timed_planet_flag = {
											flag = cs_ai_building_flag
											days = 150
										}
									}
								}

						}
						1 = {
							add_building = building_research_lab_1
							set_timed_planet_flag = {
								flag = cs_ai_building_flag
								days = 150
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_exotic_gases } }
							}
							add_building = building_refinery
							set_timed_planet_flag = {
								flag = cs_ai_building_flag
								days = 150
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_volatile_motes } }
							}
							add_building = building_chemical_plant
							set_timed_planet_flag = {
								flag = cs_ai_building_flag
								days = 150
							}
						}
						1 = {
							modifier = {
								factor = 0
								NOT = { owner = { has_technology = tech_rare_crystals } }
							}
							add_building = building_crystal_plant
							set_timed_planet_flag = {
								flag = cs_ai_building_flag
								days = 150
							}
						}


					}

			}
			5 = {
				modifier = {
					factor = 0
					OR = {
						free_district_slots = 0
						has_planet_flag = cs_ai_building_flag
					}
				}

				random_list = {
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_city
								value = 0
							}
						}
						add_district = district_city
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_generator
								value = 0
							}
						}
						add_district = district_generator
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_mining
								value = 0
							}
						}
						add_district = district_mining
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_farming
								value = 0
							}
						}
						add_district = district_farming
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_arcology_civilian_industry
								value = 0
							}
						}
						add_district = district_arcology_civilian_industry
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_arcology_arms_industry
								value = 0
							}
						}
						add_district = district_arcology_arms_industry
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_arcology_leisure
								value = 0
							}
						}
						add_district = district_arcology_leisure
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_hab_mining
								value = 0
							}
						}
						add_district = district_hab_mining
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_hab_energy
								value = 0
							}
						}
						add_district = district_hab_energy
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_hab_science
								value = 0
							}
						}
						add_district = district_hab_science
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_hab_cultural
								value = 0
							}
						}
						add_district = district_hab_cultural
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_hab_science
								value = 0
							}
						}
						add_district = district_hab_science
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_rw_generator
								value = 0
							}
						}
						add_district = district_rw_generator
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_rw_science
								value = 0
							}
						}
						add_district = district_rw_science
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
					5 = {
						modifier = {
							factor = 0
							num_free_districts = {
								type = district_rw_farming
								value = 0
							}
						}
						add_district = district_rw_farming
						set_timed_planet_flag = {
							flag = cs_ai_building_flag
							days = 150
						}
					}
				}

			}
		}

		planet_event = {
			id = civilnegotiations.53
			days = 15
		}
	}

}


country_event = {
	id = civilnegotiations.54
	is_triggered_only = yes
	hide_window = yes

	trigger = {
		is_ai = yes
	}


	immediate = {

		log = "civil society: AI - rights demand problem"

		random_list = {
			10 = {

				log = "civil society: AI - trying to solve rights problem"

				if = {
					limit = { 
						event_target:cs_target_species_rights = {
							has_citizenship_type = {
								country = root
								type = citizenship_full
							}
							OR = {
								has_living_standard = {
									country = root
									type = living_standard_normal
								}
								has_living_standard = {
									country = root
									type = living_standard_good
								}
							}
						}
					}

					random_list = {
						3 = {
							modifier = {
								factor = 0
								event_target:cs_target_species_rights = {
									has_living_standard = {
										country = root
										type = living_standard_good
									}
								}
							}

							log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_good"


							event_target:cs_target_species_rights = {
								set_living_standard = {
									country = root
									type = living_standard_good
									cooldown = yes
								}
							}

						}
						0 = {
							modifier = {
								add = 1
								is_materialist = yes
							}

							log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_academic_privilege"

								event_target:cs_target_species_rights = {
									set_living_standard = {
										country = root
										type = living_standard_academic_privilege
										cooldown = yes
									}
								}

						}
						0 = {
							modifier = {
								add = 1
								is_egalitarian = yes
							}

							log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_utopian"

								event_target:cs_target_species_rights = {
									set_living_standard = {
										country = root
										type = living_standard_utopian
										cooldown = yes
									}
								}

						}
						0 = {
							modifier = {
								add = 1
								has_valid_civic = civic_shared_burden
							}

							log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_shared_burden"


								event_target:cs_target_species_rights = {
									set_living_standard = {
										country = root
										type = living_standard_shared_burden
										cooldown = yes
									}
								}

						}
						0 = {
							modifier = {
								add = 1
								is_authoritarian = yes
							}

							log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_stratified"

								event_target:cs_target_species_rights = {
									set_living_standard = {
										country = root
										type = living_standard_stratified
										cooldown = yes
									}
								}

						}
					}
					

				}
				else_if = {
					limit = { 
						event_target:cs_target_species_rights = {
							has_citizenship_type = {
								country = root
								type = citizenship_limited
							}
							has_living_standard = {
								country = root
								type = living_standard_normal
							}
						}
					}

					log = "civil society: AI - grant [cs_target_species_rights.GetName] citizenship_full"

						event_target:cs_target_species_rights = {
							set_citizenship_type = {
								country = root
								type = citizenship_full
								cooldown = yes
							}
						}

				}
				else_if = {
					limit = { 
						event_target:cs_target_species_rights = {
							has_citizenship_type = {
								country = root
								type = citizenship_limited
							}
							has_living_standard = {
								country = root
								type = living_standard_subsistence
							}
						}
					}

					log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_normal"

						event_target:cs_target_species_rights = {
							set_living_standard = {
								country = root
								type = living_standard_normal
								cooldown = yes
							}
						}

				}
				else_if = {
					limit = { 
						event_target:cs_target_species_rights = {
							has_citizenship_type = {
								country = root
								type = citizenship_limited
							}
							has_living_standard = {
								country = root
								type = living_standard_normal
							}
						}
					}

					log = "civil society: AI - grant [cs_target_species_rights.GetName] living_standard_good"

						event_target:cs_target_species_rights = {
							set_living_standard = {
								country = root
								type = living_standard_good
								cooldown = yes
							}
						}

				}

			}
			3 = {
				modifier = {
					add = 2
					is_authoritarian = yes
				}

				log = "civil society: AI - deny [cs_target_species_rights.GetName] rights and demand"

			}
		}
	}

}