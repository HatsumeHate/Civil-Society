
namespace = civilsocietyperiodic


# REFUGEE CHECKER
country_event = {

	id = civilsocietyperiodic.1
	
	is_triggered_only = yes
	hide_window = yes
	
	
	trigger = {
		is_country_type = default
	}
	
	
	immediate = {
		every_owned_planet = {
			limit = {
				exists = owner
				has_ground_combat = no
				has_owner = yes
				has_planet_flag = civil_disturbance_flag
					OR = {
						has_planet_flag = civil_disturbance_level_3
						has_planet_flag = civil_disturbance_level_4
						has_planet_flag = civil_disturbance_level_5
					}
				NOT = { has_modifier = civil_resettlment_blockade } 
				NOT = { has_planet_flag = civil_resettlment_cooldown_flag } 
				num_pops > 3
			}
			
			random_list = {
				10 = {
					modifier = {
						factor = 2
						has_planet_flag = civil_disturbance_level_3
					}
					modifier = {
						factor = 3
						has_planet_flag = civil_disturbance_level_4
					}
					modifier = {
						factor = 4
						has_planet_flag = civil_disturbance_level_5
					}
					
					planet_event = { id = civilsocietyperiodic.2 }
				
				}
				90 = {
					modifier = {
						add = 30
						has_planet_flag = cs_tickets_flag
					}
				}
			}
		}
	}
}


# REFUGEES EVENT
planet_event = {

	id = civilsocietyperiodic.2
	
	title = "civilsocietyperiodic.2.name"
	desc = "civilsocietyperiodic.2.desc"
	picture = GFX_evt_ship_travel
	show_sound = event_ship_thrusters
	location = this
	

	is_triggered_only = yes
	
	
	immediate = {
		set_variable = { which = max_pop value = 1 }
		set_variable = { which = seed_amount value = 2 }
					
		random_list = {
			2 = { set_variable = { which = max_pop value = 2 } }
			3 = { set_variable = { which = max_pop value = 1 } }
		}
	
		set_variable = { which = total_transported value = 1 }
					

		while = {
			limit = {
				num_pops > 3
				check_variable = {
					which = max_pop
					value > 0
				}
				check_variable = {
					which = seed_amount
					value > 0
				}
			}

				random_owned_pop = {
					weights = {
						base = 1
						modifier = {
							add = 1
							has_trait = trait_nomadic
						}
						modifier = {
							add = 2
							happiness < 0.35
						}
						modifier = {
							add = 1
							happiness <= 0.5
						}
						modifier = {
							add = 2
							is_unemployed = yes
						}
						modifier = {
							mult = 0
							pop_cant_flee = yes
						}
					}
					
					save_event_target_as = refugee_pop
					refugee_pop_effect = yes
					#pop_event = { id = refugees.4 }

					prev = {
						subtract_variable = { which = max_pop value = 1 }
						change_variable = { which = total_transported value = 1 }
					}
				}
				subtract_variable = { which = seed_amount value = 1 }
				set_timed_planet_flag = { flag = civil_resettlment_cooldown_flag months = @civil_resettlment_cooldown_duration }
		}

		set_variable = { 
			which = max_pop 
			value = 0 
		}

		set_variable = { 
			which = seed_amount 
			value = 0 
		}


		if = {
			limit = {
				check_variable = {
					which = total_transported
					value = 3
				}
			}
			set_variable = {
				which = cost
				value = 125
			}
			set_variable = {
				which = society_blank
				value = 300
			}
		}
		else = {
			set_variable = {
				which = cost
				value = 75
			}
			set_variable = {
				which = society_blank
				value = 150
			}
		}

	}

	after = {
		hidden_effect = {
			set_variable = {
				which = total_transported
				value = 0
			}
			set_variable = {
				which = cost
				value = 0
			}
			set_variable = {
				which = society_blank
				value = 0
			}
		}
	}
	
	option = {
		name = civilsocietyperiodic.2.gen
	}
	option = {
		name = civilsocietyperiodic.2.a
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_authoritarian
					has_ethic = ethic_fanatic_authoritarian
				}
			}
		}
	}
	option = {
		name = civilsocietyperiodic.2.mil
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_militarist
					has_ethic = ethic_fanatic_militarist
				}
			}
		}
	}
	option = {
		name = civilsocietyperiodic.2.mat
		custom_tooltip = civilsocietyperiodic.2.mat_tooltip
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_materialist
					has_ethic = ethic_fanatic_materialist
				}
			}
		}
		hidden_effect = {
			owner = {
				add_resource = {
					society_research  = 150
				}
			}
			if = {
				limit = {
					check_variable = {
						which = total_transported
						value = 3
					}
				}
				owner = {
					add_resource = {
						society_research  = 300
					}
				}
			}
		}
	}
	option = {
		name = civilsocietyperiodic.2.eg
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_egalitarian
					has_ethic = ethic_fanatic_egalitarian
				}
			}
		}
		custom_tooltip = civilsocietyperiodic.2.eg_tooltip
		hidden_effect = {
			set_timed_planet_flag = {
				flag = cs_tickets_flag
				days = 360
			}
			owner = {
				add_resource = {
					energy = 75
				}
			}
			if = {
				limit = {
					check_variable = {
						which = total_transported
						value = 3
					}
				}
				owner = {
					add_resource = {
						energy = 75
					}
				}
			}
		}
	}
	option = {
		name = civilsocietyperiodic.2.pc
		trigger = {
			owner = {
				OR = {
					has_ethic = ethic_pacifist
					has_ethic = ethic_fanatic_pacifist
				}
			}
		}
	}
	option = {
		name = civilsocietyperiodic.2.x
		trigger = {
			owner = {
				is_pacifist = no
			}
		}
		tooltip = {
			add_modifier = { modifier = "civil_resettlment_blockade" months = @civil_society_blockade_duration }
		}
		hidden_effect = {
			add_modifier = { 
				modifier = "civil_resettlment_blockade" 
				months = @civil_society_blockade_duration 
			}
		}
	}
}


# RAID EVENT
country_event = {

	id = civilsocietyperiodic.3
	
	is_triggered_only = yes
	hide_window = yes
	
	
	trigger = {
		is_country_type = default
	}
	
	
	immediate = {
		every_owned_planet = {
			limit = {
				exists = owner
				has_ground_combat = no
				has_owner = yes
				has_planet_flag = civil_disturbance_flag
					OR = {
						has_planet_flag = civil_disturbance_level_3
						has_planet_flag = civil_disturbance_level_4
						has_planet_flag = civil_disturbance_level_5
					}
				has_modifier = civil_raid
				NOT = { has_planet_flag = civil_raid_cooldown_flag }
				num_pops > 3
			}

			random_list = {
				50 = {
						
					random_owned_pop = {
						weights = {
							base = 1
							modifier = {
								add = 2
								NOR = { 
									has_ethic = ethic_militarist 
									has_ethic = ethic_authoritarian
								}
							}
							modifier = {
								add = 2
								happiness <= 0.5
							}
							modifier = {
								add = 3
								happiness <= 0.35
							}
							modifier = {
								add = 4
								happiness <= 0.25
							}
							modifier = {
								add = 2
								is_unemployed = yes
							}
							modifier = {
								mult = 0
								pop_cant_flee = yes
							}
						}
						
						save_event_target_as = refugee_pop
						refugee_pop_effect = yes
						#pop_event = { id = refugees.4 }

						prev = {

							set_timed_planet_flag = { 
								flag = civil_raid_cooldown_flag
								months = @civil_raid_cooldown_duration
							}

							every_owned_pop = {
								limit = {
									OR = {
										is_authoritarian = yes
										is_militarist = yes
									}
								}
								add_modifier = {
									modifier = civil_pop_exiled
									months = 24
								}
							}
							
						}
					}
						
				
				}
				50 = {
				
				}
			}
		}
	}
}


# PLANETARY DESTRUCTIONS
country_event = {

	id = civilsocietyperiodic.4
	
	is_triggered_only = yes
	hide_window = yes
	
	
	trigger = {
		is_country_type = default
	}
	
	
	immediate = {
		every_owned_planet = {
			limit = {
				exists = owner
				has_ground_combat = no
				has_owner = yes
				has_planet_flag = civil_disturbance_flag
					OR = {
						has_planet_flag = civil_disturbance_level_3
						has_planet_flag = civil_disturbance_level_4
						has_planet_flag = civil_disturbance_level_5
					}
				NOT = { has_planet_flag = civil_devastation_flag } 
			}

			random_list = {
				25 = {
					modifier = {
						has_modifier = civil_damage_control
						add = -10
					}
					modifier = {
						add = 5
						has_planet_flag = civil_disturbance_level_3
					}
					modifier = {
						add = 10
						has_planet_flag = civil_disturbance_level_4
					}
					modifier = {
						add = 15
						has_planet_flag = civil_disturbance_level_5
					}
					modifier = {
						factor = 0
						NAND = {
							has_district = district_mining 
							has_district = district_city
							has_district = district_farming
							has_district = district_generator
						}
					}

				

					random_list = {
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_district = district_mining }
									has_modifier = civil_mining_district_devastations
								}
							}
							planet_event = { id = civilsocietyperiodic.8 }
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_district = district_city }
									has_modifier = civil_city_district_devastations
								}
							}
							planet_event = { id = civilsocietyperiodic.9 }
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_district = district_farming }
									has_modifier = civil_farming_district_devastations
								}
							}
							planet_event = { id = civilsocietyperiodic.10 }
						}
						1 = {
							modifier = {
								factor = 0
								OR = {
									NOT = { has_district = district_generator }
									has_modifier = civil_energy_district_devastations 
								}
							}
							planet_event = { id = civilsocietyperiodic.11 }
							
						}
					}
				
				}
				50 = {
					modifier = {
						has_modifier = civil_damage_control
						add = -10
					}
					modifier = {
						add = 5
						has_planet_flag = civil_disturbance_level_3
					}
					modifier = {
						add = 10
						has_planet_flag = civil_disturbance_level_4
					}
					modifier = {
						add = 15
						has_planet_flag = civil_disturbance_level_5
					}

					random_list = {
						3 = { 
							set_variable = {
								which = degree
								value = 1
							}
						}
						2 = { 
							set_variable = {
								which = degree
								value = 2
							}
						}
						1 = {
							set_variable = {
								which = degree
								value = 3
							}
						}
					}


					if = {
						limit = {
							check_variable = {
								which = degree
								value = 1
							}
						}
						planet_event = { id = civilsocietyperiodic.5 }
					}
					else_if = {
						limit = {
							check_variable = {
								which = degree
								value = 2
							}
						}
						planet_event = {
							id = civilsocietyperiodic.6
						}
					}
					else_if = {
						limit = {
							check_variable = {
								which = degree
								value = 3
							}
						}
						planet_event = {
							id = civilsocietyperiodic.7
						}
					}
					
					set_timed_planet_flag = {
						flag = civil_devastation_flag
						months = @civil_devastation_flag_duration
					}

				}
				125 = {}
			}
		}
	}
}


# LIGHT DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.5
	title = "civilsocietyperiodic.5.name"
	desc = "civilsocietyperiodic.5.desc"
	picture = GFX_evt_night_raid
	show_sound = event_air_raid_siren
	location = this

	is_triggered_only = yes	

	immediate = {
		add_planet_devastation = 10
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_planet_devastation = 10
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 100 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -100
				}
			}
			add_planet_devastation = 5
			
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -100
				}
			}
			add_planet_devastation = -5
		}
	}
	
}

# MEDIUM DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.6
	title = "civilsocietyperiodic.6.name"
	desc = "civilsocietyperiodic.6.desc"
	picture = GFX_evt_night_raid
	show_sound = event_air_raid_siren
	location = this

	is_triggered_only = yes	

	immediate = {
		add_planet_devastation = 15
		random_list = {
			50 = {
				random_owned_pop = {
					limit = {
						is_sapient = yes
					}
					kill_pop = yes
				}
			}
			50 = {

			}
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_planet_devastation = 15
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 200 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -200
				}
			}
			add_planet_devastation = 8
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -200
				}
			}
			add_planet_devastation = -7
		}
	}
	
}

# HEAVY DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.7
	title = "civilsocietyperiodic.7.name"
	desc = "civilsocietyperiodic.7.desc"
	picture = GFX_evt_night_raid
	show_sound = event_air_raid_siren
	location = this

	is_triggered_only = yes	


	immediate = {
		add_planet_devastation = 20

		while = {
			count = 2
			random_owned_pop = {
				limit = {
					is_sapient = yes
				}
				random_list = {
					50 = {
						kill_pop = yes
					}
					50 = {

					}
				}
			}
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_planet_devastation = 20
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 500 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_planet_devastation = 10
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_planet_devastation = -10
		}
	}
	
}

# MINING DISTRICT DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.8
	title = "civilsocietyperiodic.8.name"
	desc = "civilsocietyperiodic.8.desc"
	picture = GFX_evt_night_raid
	show_sound = event_structural_collapse
	location = this

	is_triggered_only = yes	

	immediate = {
		add_modifier = {
			modifier = "civil_mining_district_devastations"
			months = 12
		}
		set_timed_planet_flag = {
			flag = civil_devastation_flag
			months = @civil_devastation_flag_duration
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_modifier = {
				modifier = "civil_mining_district_devastations"
				months = 12
			}
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 500 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_modifier = {
				modifier = "civil_mining_district_devastations"
				months = 7
			}
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			remove_modifier = "civil_mining_district_devastations"
			add_modifier = {
				modifier = "civil_mining_district_devastations"
				months = 7
			}
		}
	}

}


# CITY DISTRICT DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.9
	title = "civilsocietyperiodic.9.name"
	desc = "civilsocietyperiodic.9.desc"
	picture = GFX_evt_night_raid
	show_sound = event_ground_battle
	location = this

	is_triggered_only = yes	

	immediate = {
		add_modifier = {
			modifier = "civil_city_district_devastations"
			months = 12
		}
		set_timed_planet_flag = {
			flag = civil_devastation_flag
			months = @civil_devastation_flag_duration
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_modifier = {
				modifier = "civil_mining_district_devastations"
				months = 12
			}
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 500 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_modifier = {
				modifier = "civil_city_district_devastations"
				months = 7
			}
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			remove_modifier = "civil_city_district_devastations"
			add_modifier = {
				modifier = "civil_city_district_devastations"
				months = 7
			}
		}
	}

}


# FOOD DISTRICT DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.10
	title = "civilsocietyperiodic.10.name"
	desc = "civilsocietyperiodic.10.desc"
	picture = GFX_evt_night_raid
	show_sound = event_planetary_riot
	location = this

	is_triggered_only = yes

	immediate = {
		add_modifier = {
			modifier = "civil_farming_district_devastations"
			months = 12
		}
		set_timed_planet_flag = {
			flag = civil_devastation_flag
			months = @civil_devastation_flag_duration
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_modifier = {
				modifier = "civil_farming_district_devastations"
				months = 12
			}
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 500 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_modifier = {
				modifier = "civil_farming_district_devastations"
				months = 7
			}
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			remove_modifier = "civil_farming_district_devastations"
			add_modifier = {
				modifier = "civil_farming_district_devastations"
				months = 7
			}
		}
	}

}


# ENERGY DISTRICT DEVASTATION
planet_event = {
	
	id = civilsocietyperiodic.11
	title = "civilsocietyperiodic.11.name"
	desc = "civilsocietyperiodic.11.desc"
	picture = GFX_evt_night_raid
	show_sound = event_super_explosion
	location = this

	is_triggered_only = yes	

	immediate = {
		add_modifier = {
			modifier = "civil_energy_district_devastations"
			months = 12
		}
		set_timed_planet_flag = {
			flag = civil_devastation_flag
			months = @civil_devastation_flag_duration
		}
	}

	option = {
		name = civilsocietyperiodic.5.gen
		tooltip = {
			add_modifier = {
				modifier = "civil_energy_district_devastations"
				months = 12
			}
		}
	}
	option = {
		name = civilsocietyperiodic.5.x
		allow = {
			owner = {
				has_resource = { type = minerals amount >= 500 }
			}
		}
		tooltip = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			add_modifier = {
				modifier = "civil_energy_district_devastations"
				months = 7
			}
		}
		hidden_effect = {
			owner = {
				add_resource = {
					minerals = -500
				}
			}
			remove_modifier = "civil_energy_district_devastations"
			add_modifier = {
				modifier = "civil_energy_district_devastations"
				months = 7
			}
		}
	}
	
}